---
title: "mb5370-module-4-report"
author: "Carolina Freitas"
date: '2023-05-03'
output: html_document
---


#Workshop 4
```{r}
setwd("~/JCU/MB5370/Module 4/github/mb5370/data")
```
## QFISH

```{r}
#Importing QFish data
library (readr)
shark <- read.csv("data/sharkcontrol.csv")
```

```{r}
#Ensures every blank space is identified as a blank space

shark <- as.data.frame(lapply(shark, function(x) gsub("^\\s*$", "", x)))
# ^ represents the start of line
#\\s matches any whitespace character
#* specifies that the previous symbol "\\s" can occur zero or more times. 
#$ represents the end of line

```

# Tidying the data ####
```{r}
library(dplyr)
library(tidyr)
shark_table <- setNames(shark, c("Area", paste(names(shark), unlist(shark[1, ], use.names = FALSE), sep = "_")[-1])) %>% 
  slice(-1) %>% 
  pivot_longer(-Area) %>% 
  separate(name, into = c("Year", "SpeciesGroup"), sep = "_")
#This section reorganises the table into Area, Year, species group and value which = catches
#stringr function for year problem
```


```{r}
#Remove prefix Area. and X from columns 1 and 2
shark_table <- shark_table %>%
  mutate(Area = sub("^Area\\.", "", Area),
         Year = sub("^X", "", Year))
```

```{r}
#Rename column from value to catches
colnames(shark_table)[colnames(shark_table) == "value"] <- "Catches"
```

```{r}
#Remove all rows with totals and grand totals
#install.packages("stringr")
library(stringr)

shark_table <- shark_table[!str_detect(shark_table$Area, "Grand Total") & !str_detect(shark_table$Year, "Total"), ]

```

```{r}
#Remove the suffix in the years. e.g. 2001.1 is replaced by 2001
shark_table$Year <- str_remove(shark_table$Year, "\\..*")
```

```{r}
#Remove all rows with blank cells
shark_clean <- subset(shark_table, !is.na(Catches) & nzchar(as.character(Catches)))
#subset() function is used to filter the dataframe based on the !is.na and nzchar condition.
#this condition selects the rows where the cells under the column Catches is not empty
```

# Plotting the data into a timeseries ####
```{r}
#converting catches values to numerical data
shark_clean$Catches <- as.numeric(shark_clean$Catches)
```

```{r}
# creating a data table for the timeseries

totals_per_year <- shark_clean %>%
  group_by(Year, SpeciesGroup) %>%
  summarise(TotalCatches = sum(Catches))

# View the resulting table
print(totals_per_year)
```


```{r}
ggplot(totals_per_year, aes(x = Year, y = TotalCatches, color = SpeciesGroup, group = SpeciesGroup)) +
  theme_minimal() +
  geom_line() +
  labs(x = "Year", y = "Total Catches", color = "Species Group") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
 
```


